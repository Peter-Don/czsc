# CZSC笔判断参数配置指南

## 概述

本文档详细介绍了CZSC笔判断功能的所有参数配置，包括如何通过配置文件或代码参数来调整笔判断的行为。

## 配置文件位置

主配置文件：`config/pen_config.json`

## 参数分类

### 1. 笔模式参数 (`pen_settings`)

#### 1.1 `default_pen_model` (默认笔模式)
- **位置**：`config/pen_config.json` → `pen_settings` → `default_pen_model`
- **可选值**：
  - `"standard"`: 标准模式，需要5根K线
  - `"flexible"`: 灵活模式，只需3根K线
- **默认值**：`"standard"`
- **说明**：控制全局默认的笔判断模式

#### 1.2 `default_use_adaptive_pen` (默认自适应笔启用状态)
- **位置**：`config/pen_config.json` → `pen_settings` → `default_use_adaptive_pen`
- **可选值**：`true` / `false`
- **默认值**：`false`
- **说明**：控制是否默认启用自适应笔功能

#### 1.3 标准模式配置 (`standard_mode`)
- **位置**：`config/pen_config.json` → `pen_settings` → `standard_mode`
- **参数**：
  - `min_bi_len`: 最小笔长度，固定为5
  - `description`: 模式描述

#### 1.4 灵活模式配置 (`flexible_mode`)
- **位置**：`config/pen_config.json` → `pen_settings` → `flexible_mode`
- **参数**：
  - `min_bi_len`: 最小笔长度，固定为3
  - `description`: 模式描述

#### 1.5 自适应模式配置 (`adaptive_mode`)
- **位置**：`config/pen_config.json` → `pen_settings` → `adaptive_mode`
- **参数**：
  - `enabled`: 是否启用，`true`/`false`
  - `volume_ratio`: 成交量放大倍数，默认2.0
  - `atr_ratio`: ATR放大倍数，默认2.0
  - `atr_period`: ATR计算周期，默认14
  - `volume_period`: 成交量均线周期，默认20

### 2. 指标参数 (`indicator_settings`)

#### 2.1 ATR指标配置
- **位置**：`config/pen_config.json` → `indicator_settings` → `atr`
- **参数**：
  - `period`: ATR计算周期，默认14
  - `description`: 指标描述

#### 2.2 成交量指标配置
- **位置**：`config/pen_config.json` → `indicator_settings` → `volume_ma`
- **参数**：
  - `period`: 成交量移动平均周期，默认20
  - `description`: 指标描述

### 3. 自适应阈值参数 (`adaptive_thresholds`)

#### 3.1 保守模式 (`conservative`)
- **位置**：`config/pen_config.json` → `adaptive_thresholds` → `conservative`
- **参数**：
  - `volume_ratio`: 1.5 (容易触发)
  - `atr_ratio`: 1.0 (容易触发)
  - **适用场景**：希望捕捉更多的自适应笔

#### 3.2 适中模式 (`moderate`)
- **位置**：`config/pen_config.json` → `adaptive_thresholds` → `moderate`
- **参数**：
  - `volume_ratio`: 2.0 (平衡)
  - `atr_ratio`: 1.5 (平衡)
  - **适用场景**：大多数情况下的平衡选择

#### 3.3 激进模式 (`aggressive`)
- **位置**：`config/pen_config.json` → `adaptive_thresholds` → `aggressive`
- **参数**：
  - `volume_ratio`: 3.0 (难触发)
  - `atr_ratio`: 2.5 (难触发)
  - **适用场景**：只在极端情况下才触发自适应笔

### 4. 市场特定参数 (`market_specific`)

#### 4.1 加密货币市场 (`crypto`)
- **位置**：`config/pen_config.json` → `market_specific` → `crypto`
- **参数**：
  - `volume_ratio`: 2.5
  - `atr_ratio`: 2.0
- **特点**：波动性大，需要更严格的条件

#### 4.2 股票市场 (`stock`)
- **位置**：`config/pen_config.json` → `market_specific` → `stock`
- **参数**：
  - `volume_ratio`: 1.8
  - `atr_ratio`: 1.5
- **特点**：相对稳定，可以使用较宽松的条件

#### 4.3 期货市场 (`futures`)
- **位置**：`config/pen_config.json` → `market_specific` → `futures`
- **参数**：
  - `volume_ratio`: 2.2
  - `atr_ratio`: 1.8
- **特点**：杠杆效应，需要中等严格的条件

## 参数修改方法

### 方法1：直接修改配置文件

1. 打开 `config/pen_config.json`
2. 找到要修改的参数
3. 修改参数值
4. 保存文件

**示例**：将默认模式改为灵活模式
```json
{
    "pen_settings": {
        "default_pen_model": "flexible",  // 改为灵活模式
        "default_use_adaptive_pen": true  // 启用自适应笔
    }
}
```

### 方法2：通过代码动态修改

```python
from czsc.config_loader import pen_config

# 修改自适应模式参数
pen_config.update_adaptive_config(
    volume_ratio=2.5,
    atr_ratio=1.8,
    enabled=True
)

# 查看当前配置
pen_config.print_config_info()
```

### 方法3：代码中覆盖参数

```python
# 使用配置文件但覆盖特定参数
c = CZSC(bars, 
         market_type='crypto',           # 使用加密货币市场配置
         adaptive_vol_ratio=3.0,         # 但覆盖成交量比率
         threshold_mode='conservative')   # 使用保守阈值模式
```

## 参数调优建议

### 1. 成交量比率 (`volume_ratio`)

**作用**：判断成交量是否异常放大

**调优建议**：
- **1.2-1.5**：非常敏感，适合流动性好的市场
- **1.8-2.2**：适中敏感度，适合大多数市场
- **2.5-3.5**：较低敏感度，适合噪音较多的市场

**修改位置**：
```json
{
    "market_specific": {
        "your_market": {
            "volume_ratio": 2.0  // 修改这里
        }
    }
}
```

### 2. ATR比率 (`atr_ratio`)

**作用**：判断价格波动是否异常

**调优建议**：
- **1.0-1.3**：非常敏感，适合波动性小的市场
- **1.5-2.0**：适中敏感度，适合大多数市场
- **2.2-3.0**：较低敏感度，适合高波动市场

**修改位置**：
```json
{
    "market_specific": {
        "your_market": {
            "atr_ratio": 1.5  // 修改这里
        }
    }
}
```

### 3. 指标周期参数

#### ATR周期 (`atr_period`)
- **默认值**：14
- **调优建议**：
  - **7-10**：更敏感，适合短期交易
  - **14-20**：标准设置，适合中期分析
  - **21-30**：更平滑，适合长期分析

**修改位置**：
```json
{
    "pen_settings": {
        "adaptive_mode": {
            "atr_period": 14  // 修改这里
        }
    }
}
```

#### 成交量周期 (`volume_period`)
- **默认值**：20
- **调优建议**：
  - **10-15**：更敏感，适合短期交易
  - **20-30**：标准设置，适合中期分析
  - **40-60**：更平滑，适合长期分析

**修改位置**：
```json
{
    "pen_settings": {
        "adaptive_mode": {
            "volume_period": 20  // 修改这里
        }
    }
}
```

## 不同市场的推荐配置

### 1. 加密货币市场
```json
{
    "market_specific": {
        "crypto": {
            "volume_ratio": 2.5,  // 高波动性，需要更严格的成交量条件
            "atr_ratio": 2.0,     // 高波动性，需要更严格的价格条件
            "description": "加密货币市场：24小时交易，波动性大"
        }
    }
}
```

### 2. 股票市场
```json
{
    "market_specific": {
        "stock": {
            "volume_ratio": 1.8,  // 相对稳定，可以使用较宽松的条件
            "atr_ratio": 1.5,     // 波动性较小，较宽松的价格条件
            "description": "股票市场：交易时间固定，相对稳定"
        }
    }
}
```

### 3. 期货市场
```json
{
    "market_specific": {
        "futures": {
            "volume_ratio": 2.2,  // 杠杆效应，需要中等严格的条件
            "atr_ratio": 1.8,     // 杠杆放大波动，需要适中的条件
            "description": "期货市场：杠杆交易，需要平衡的参数"
        }
    }
}
```

## 参数验证

### 配置文件验证
系统会自动验证配置文件的格式和内容：
- JSON格式是否正确
- 必需的配置项是否存在
- 参数值是否在合理范围内

### 参数范围建议
- `volume_ratio`: 1.0 - 5.0
- `atr_ratio`: 0.5 - 3.0
- `atr_period`: 5 - 50
- `volume_period`: 5 - 100

## 使用示例

### 1. 基础使用
```python
# 使用默认配置
c = CZSC(bars)

# 使用特定市场配置
c = CZSC(bars, market_type='crypto')

# 使用特定阈值模式
c = CZSC(bars, threshold_mode='conservative')
```

### 2. 高级使用
```python
# 完全自定义配置
c = CZSC(bars, 
         pen_model='flexible',           # 灵活模式
         use_adaptive_pen=True,          # 启用自适应笔
         adaptive_vol_ratio=2.5,         # 自定义成交量比率
         adaptive_atr_ratio=1.8,         # 自定义ATR比率
         market_type='crypto',           # 加密货币市场
         threshold_mode='moderate')      # 适中阈值模式
```

### 3. 运行时修改
```python
from czsc.config_loader import pen_config

# 查看当前配置
pen_config.print_config_info()

# 修改配置
pen_config.update_adaptive_config(
    volume_ratio=2.0,
    atr_ratio=1.5,
    enabled=True
)

# 获取特定市场配置
config = pen_config.get_pen_config_for_market('crypto', 'aggressive')
print(config)
```

## 常见问题

### Q1: 配置文件修改后不生效怎么办？
**A**: 需要重新创建CZSC对象或重新导入配置：
```python
# 重新导入配置
from czsc.config_loader import pen_config
pen_config = PenConfigLoader()

# 或者重新创建对象
c = CZSC(bars)
```

### Q2: 如何添加新的市场类型？
**A**: 在配置文件中添加新的市场配置：
```json
{
    "market_specific": {
        "forex": {
            "volume_ratio": 2.0,
            "atr_ratio": 1.6,
            "description": "外汇市场"
        }
    }
}
```

### Q3: 如何临时禁用自适应笔？
**A**: 使用代码参数覆盖：
```python
c = CZSC(bars, use_adaptive_pen=False)
```

### Q4: 配置文件损坏了怎么办？
**A**: 系统会自动使用默认值并输出警告。可以删除配置文件，系统会使用内置默认值。

## 总结

通过灵活的配置系统，用户可以：
1. 通过配置文件进行全局设置
2. 通过代码参数进行局部覆盖
3. 针对不同市场使用不同的预设配置
4. 根据交易策略选择合适的阈值模式
5. 动态调整参数以适应市场变化

建议用户从默认配置开始，根据实际使用效果逐步调整参数，找到最适合自己交易风格和市场特征的配置。